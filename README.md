# Maplestory魔方词条刷新助手

使用Python和Tkinter编写，用于自动刷新游戏中的词条直到满足用户定义的规则。测试环境为GMS服务器。其他语言环境请安装相应的OCR支持。

## 功能

-   **区域选择**: 用户可以手动框选屏幕上需要进行OCR识别的区域和点击刷新操作的区域。
-   **规则定义**: 用户可以创建包含最多三个词条的规则，并为规则命名。词条支持使用 `*` 作为通配符。
-   **规则管理**: 用户可以保存当前定义的规则到 `rules.json` 文件，也可以从该文件加载规则。
-   **自动刷新**: 程序会模拟点击刷新区域，然后按下三次Enter键来刷新游戏内词条。
-   **OCR识别**: 使用Tesseract OCR识别指定区域内的文本。
-   **规则匹配**: 将识别到的词条与用户选择的规则进行匹配（顺序无关）。
    -   词条名称（冒号前部分）需要精确匹配。
    -   如果规则中词条的冒号后指定了具体数值/文本，则该部分也需要精确匹配。
-   **自动停止**: 一旦识别到的词条满足任意一个选定规则，程序将自动停止刷新。
-   **状态显示**: GUI界面会显示当前的操作状态和OCR识别结果。

## 安装与运行

### 1. 安装依赖

确保你的系统上安装了 Python 3。

首先，你需要安装Tesseract OCR引擎。请访问 [Tesseract OCR GitHub](https://github.com/tesseract-ocr/tesseract) 页面根据你的操作系统下载并安装。**重要**: 在安装过程中，请确保选择安装中文简体语言包 (`chi_sim`)，并将Tesseract的安装路径添加到系统的PATH环境变量中。

然后，在项目根目录 (包含 `requirements.txt` 文件的目录) 打开终端或命令行，运行以下命令安装所需的Python库:

```bash
pip install -r requirements.txt
```

### 2. 运行程序

在项目根目录下，通过以下命令运行主程序:

```bash
python main.py
```

### 3. 使用说明

1.  **选择识别区域**: 点击 "选择识别区域" 按钮，鼠标会变成十字形。在游戏窗口中拖动鼠标框选出包含三行词条的区域（通常是"AFTER"框内的词条部分）。
2.  **选择刷新区域**: 点击 "选择刷新区域" 按钮，同样拖动鼠标框选出游戏内用于刷新词条的按钮（例如 "ONE MORE TRY" 按钮）。程序会点击这个区域的中心。
3.  **定义规则**:
    *   在 "规则名称" 输入框中为你的规则命名。
    *   在 "词条1", "词条2", "词条3" 输入框中输入期望的词条。例如：
        *   `Magic ATT: +12%` (精确匹配)
        *   `DEX:` (只匹配词条名称，忽略后面的值)
        *   `*` (通配符，匹配任意词条)
    *   点击 "添加规则"。规则会显示在右侧的列表中。
4.  **管理规则**:
    *   **删除规则**: 在规则列表中选中一个或多个规则，然后点击 "删除选中规则"。
    *   **保存规则**: 点击 "保存规则" 将当前所有规则保存到项目目录下的 `rules.json` 文件中。
    *   **加载规则**: 点击 "加载规则" 从 `rules.json` 文件加载之前保存的规则。
5.  **选择要使用的规则**: 在右侧的规则列表中，单击或按住Ctrl/Shift单击来选择一个或多个你希望在本次刷新中使用的规则。
6.  **开始刷新**: 点击 "开始刷新" 按钮。程序将开始自动刷新和识别过程。
7.  **停止刷新**: 点击 "停止刷新" 按钮或者F12快捷键可以手动停止刷新过程。
8.  **查看日志**: "OCR识别结果" 区域会显示程序的运行日志和识别到的文本。

## 注意事项

*   **Tesseract OCR路径**: 如果程序启动时提示找不到Tesseract，或者OCR识别不工作，请确保Tesseract已正确安装并已将其安装目录添加到系统PATH环境变量。如果问题依旧，你可能需要在 `main.py` 文件中手动指定Tesseract的路径，找到以下行并取消注释，修改为你的实际路径：
    ```python
    # pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe' # 示例路径
    ```
*   **OCR语言**: 当前默认使用英文 (`eng`) 和简体中文 (`chi_sim`) 进行识别。如果你的游戏词条是其他语言，可能需要修改 `perform_ocr` 函数中的 `lang` 参数，并确保已安装相应的Tesseract语言包。
*   **识别精度**: OCR的识别精度受多种因素影响，如截图区域的清晰度、字体、背景颜色等。如果识别不准确，可以尝试调整识别区域，或在 `perform_ocr` 函数中增加图像预处理步骤（如灰度化、二值化）。
*   **刷新操作**: 程序通过模拟鼠标点击和键盘按键（三次回车）进行刷新。请确保游戏窗口在前台且刷新按钮和词条区域可见。
*   **时间间隔**: 代码中包含一些 `time.sleep()` 调用，用于在操作之间提供延迟，以确保游戏有足够的时间响应。如果刷新过快或过慢，可以适当调整这些延迟时间。

## 文件结构

```
d:\desktop\洗魔方/
├── main.py           # 主程序脚本
├── requirements.txt  # Python依赖列表
├── README.md         # 本说明文件
└── rules.json        # (程序运行时自动创建/加载) 保存用户定义的规则
```
